(function(a){if(typeof a.fn.rte==="undefined"){var b={media_url:"./view/templates/images/",content_css_url:"rte.css",dot_net_button_class:null,max_height:350};a.fn.rte=function(c){a.fn.rte.html=function(e){return e.contentWindow.document.getElementsByTagName("body")[0].innerHTML};var d=a.extend(b,c);return this.each(function(){var m=a(this);var g;var e=m.attr("id");function h(){var p=m.val();if(a.trim(p)==""){p="<br />"}if(g){console.log("already created");m.hide();a(g).contents().find("body").html(p);a(g).show();a("#toolbar-"+e).remove();m.before(k());return true}g=document.createElement("iframe");g.frameBorder=0;g.frameMargin=0;g.framePadding=0;g.height=200;if(m.attr("class")){g.className=m.attr("class")}if(m.attr("id")){g.id=e}if(m.attr("name")){g.title=m.attr("name")}m.after(g);var o="";if(d.content_css_url){o="<link type='text/css' rel='stylesheet' href='"+d.content_css_url+"' />"}var q="<html><head>"+o+"</head><body class='frameBody'>"+p+"</body></html>";l(q,function(){a("#toolbar-"+e).remove();m.before(k());m.hide()})}function l(p,q){if(!g){return false}try{g.contentWindow.document.open();g.contentWindow.document.write(p);g.contentWindow.document.close()}catch(o){}if(document.contentEditable){g.contentWindow.document.designMode="On";q();return true}else{if(document.designMode!=null){try{g.contentWindow.document.designMode="on";q();return true}catch(o){}}}setTimeout(function(){l(p,q)},500);return false}function j(p){var o=a(g).contents().find("body").html();if(a(g).is(":visible")){m.val(o)}if(p!==true){m.show();a(g).hide()}}function k(){var p=a("<div class='rte-toolbar' id='toolbar-"+e+"'><div>                <p>                    <select>                        <option value=''>Block style</option>                        <option value='p'>Paragraph</option>                        <option value='h3'>Title</option>                        <option value='address'>Address</option>                    </select>                </p>                <p>                    <a href='#' class='bold'><img src='"+d.media_url+"bold.gif' alt='bold' /></a>                    <a href='#' class='italic'><img src='"+d.media_url+"italic.gif' alt='italic' /></a>                </p>                <p>                    <a href='#' class='unorderedlist'><img src='"+d.media_url+"unordered.gif' alt='unordered list' /></a>                    <a href='#' class='link'><img src='"+d.media_url+"link.png' alt='link' /></a>                    <a href='#' class='image'><img src='"+d.media_url+"image.png' alt='image' /></a>                    <a href='#' class='disable'><img src='"+d.media_url+"close.gif' alt='close rte' /></a>                </p></div></div>");a("select",p).change(function(){var s=this.selectedIndex;if(s!=0){var t=this.options[s].value;i("formatblock","<"+t+">")}});a(".bold",p).click(function(){i("bold");return false});a(".italic",p).click(function(){i("italic");return false});a(".unorderedlist",p).click(function(){i("insertunorderedlist");return false});a(".link",p).click(function(){var s=prompt("URL:");if(s){i("CreateLink",s)}return false});a(".image",p).click(function(){var s=prompt("image URL:");if(s){i("InsertImage",s)}return false});a(".disable",p).click(function(){j();var s=a('<a class="rte-edm" href="#">Design Ansicht aktivieren</a>');p.empty().append(s);s.click(function(t){t.preventDefault();h();a(this).remove()});return false});if(d.dot_net_button_class){var q=a(g).parents("form").find(d.dot_net_button_class);q.click(function(){j(true)})}else{a(g).parents("form").submit(function(){j(true)})}var r=a(g.contentWindow.document);var o=a("select",p)[0];r.mouseup(function(){n(f(),o);return true});r.keyup(function(){n(f(),o);var s=a("body",r);if(s.scrollTop()>0){var t=parseInt(g.style.height);if(isNaN(t)){t=0}g.style.height=350}return true});return p}function i(q,o){g.contentWindow.focus();try{g.contentWindow.document.execCommand(q,false,o)}catch(p){}g.contentWindow.focus()}function n(r,p){while(r.parentNode){var o=r.nodeName.toLowerCase();for(var q=0;q<p.options.length;q++){if(o==p.options[q].value){p.selectedIndex=q;return true}}r=r.parentNode}p.selectedIndex=0;return true}function f(){if(g.contentWindow.document.selection){selection=g.contentWindow.document.selection;range=selection.createRange();try{node=range.parentElement()}catch(o){return false}}else{try{selection=g.contentWindow.getSelection();range=selection.getRangeAt(0)}catch(o){return false}node=range.commonAncestorContainer}return node}h()})}}})(jQuery);